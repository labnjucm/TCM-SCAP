# ORCA Gradio 应用

一个基于 Gradio 的 ORCA 量子化学计算前端界面，提供友好的网页操作体验。

## 功能特性

- 📤 上传 ORCA 输入文件（.inp）
- 🚀 一键运行 ORCA 计算
- 🛑 终止按钮：随时停止正在运行的计算
- 📊 实时查看计算日志
- 📄 查看和下载 test.out 输出文件
- 🔧 自定义 ORCA 路径和运行目录
- 🛡️ 文件名容错处理（逗号自动修正为点）
- 📝 使用实际上传的文件名进行计算
- 🔗 快速链接到 Multiwfn 和 VMD 分析工具

## 安装依赖

```bash
pip install -r requirements.txt
```

或者直接安装：

```bash
pip install gradio>=4.0.0
```

## 前置要求

1. **安装 ORCA**：从 [ORCA 官网](https://orcaforum.kofo.mpg.de/) 下载并安装
2. **配置环境变量**：确保 `orca` 命令在系统 PATH 中可用
   - 或者在应用界面中指定 ORCA 可执行文件的完整路径

## 运行应用

```bash
python orca_gradio_app.py
```

应用将在 `http://0.0.0.0:7860` 启动，在浏览器中访问即可使用。

## 使用方法

1. **上传输入文件**：点击 "上传 ORCA 输入文件" 选择您的 `.inp` 文件
2. **配置参数**（可选）：
   - 修改 ORCA 可执行文件路径（默认为 `orca`）
   - 修改运行目录（默认为 `./orca_run`）
3. **运行计算**：点击 "▶️ Run ORCA" 按钮开始计算
4. **终止计算**（可选）：如需停止运行中的计算，点击 "🛑 终止计算" 按钮
5. **查看结果**：
   - 左侧显示运行日志和终止状态
   - 右侧可查看和下载 `test.out` 输出文件
   - 底部提供进一步分析工具的链接

## 示例文件

项目包含一个示例输入文件 `example_water.inp`，这是一个水分子的几何优化计算：

```
! B3LYP D3BJ def2-SVP Opt TightSCF

%pal nprocs 4 end
%maxcore 2048

* xyz 0 1
O   0.000000   0.000000   0.000000
H   0.000000   0.757160   0.586260
H   0.000000  -0.757160   0.586260
*
```

您可以使用此文件测试应用功能。

## 注意事项

- 计算超过 1 小时将被自动终止
- 可随时使用"终止计算"按钮手动停止运行中的任务
- 程序使用您上传文件的实际文件名执行计算，输出始终保存为 `test.out`
- 输出文件大于 4 MB 时会自动截断显示（完整文件可通过下载获取）
- 文件名如果包含逗号会被自动修正为点（例如：`test,inp` → `test.inp`）
- 建议合理设置并行线程数和内存，避免超过系统资源限制

## 技术细节

- **Python 版本**：3.10+
- **主要依赖**：Gradio 4.0+
- **架构**：单文件应用，基于 Gradio Blocks
- **命令执行**：`orca <实际文件名> > test.out`
- **进程管理**：使用 `subprocess.Popen` 和线程安全的进程管理器
- **终止机制**：优先尝试 SIGTERM（优雅终止），5秒后强制 SIGKILL

## 许可

本项目仅为 ORCA 软件的前端界面工具，ORCA 软件本身的使用需遵守其官方许可协议。

